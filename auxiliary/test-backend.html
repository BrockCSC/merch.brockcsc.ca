<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Backend API</title>
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    form { max-width: 400px; }
    label { display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; }
    button { margin-top: 20px; padding: 10px; background: #007bff; color: white; border: none; cursor: pointer; }
    #result { margin-top: 20px; white-space: pre-wrap; }
    #paymentForm { display: none; }
    #card-element { padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>Test Merch Backend API</h1>
  <p>Use this page to test the backend API. Make sure to replace the Stripe publishable key with your test key.</p>

  <form id="orderForm">
    <label for="name">Name:</label>
    <input type="text" id="name" required>

    <label for="studentId">Student ID:</label>
    <input type="number" id="studentId" required>

    <label for="email">Email:</label>
    <input type="email" id="email" required>

    <label for="color">Color:</label>
    <select id="color" required>
      <option value="BLACK">Black</option>
      <option value="WHITE">White</option>
    </select>

    <label for="size">Size:</label>
    <select id="size" required>
      <option value="S">S</option>
      <option value="M">M</option>
      <option value="L">L</option>
      <option value="XL">XL</option>
    </select>

    <button type="submit">Create Payment Intent</button>
  </form>

  <form id="paymentForm">
    <h2>Enter Payment Details</h2>
    <div id="card-element"></div>
    <button type="submit">Pay</button>
  </form>

  <div id="result"></div>

  <script>
    const orderForm = document.getElementById('orderForm');
    const paymentForm = document.getElementById('paymentForm');
    const resultDiv = document.getElementById('result');
    const stripe = Stripe('pk_test_51SPYUmDKE3K4RyLKzWjFmmmg21dXrHI29a7i1WqZ77MZVkKedmLDL82bLZ9Kh5btk57s9AMZcNadITQkZhYvyr9200YOB8snWx'); // Replace with your Stripe test publishable key
    const elements = stripe.elements();
    const card = elements.create('card');
    card.mount('#card-element');

    let clientSecret;

    orderForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const data = {
        name: document.getElementById('name').value,
        studentId: parseInt(document.getElementById('studentId').value),
        email: document.getElementById('email').value,
        color: document.getElementById('color').value,
        size: document.getElementById('size').value,
      };

      try {
        const response = await fetch('https://merch-backend.brockcsc.workers.dev', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        const result = await response.json();
        if (result.success) {
          clientSecret = result.clientSecret;
          orderForm.style.display = 'none';
          paymentForm.style.display = 'block';
          resultDiv.textContent = 'Payment intent created. Enter card details below.';
        } else {
          resultDiv.textContent = 'Error: ' + result.message;
        }
      } catch (error) {
        resultDiv.textContent = 'Error: ' + error.message;
      }
    });

    paymentForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const { error } = await stripe.confirmCardPayment(clientSecret, {
        payment_method: {
          card: card,
        },
      });

      if (error) {
        resultDiv.textContent = 'Payment failed: ' + error.message;
      } else {
        resultDiv.textContent = 'Payment succeeded!';
      }
    });
  </script>
</body>
</html>